
/* Using native system fonts */

/* Design tokens — v2 minimal elegant palette */
:root {
    --bg-color:                 #E5E5EA;
    --text-color:               #1C1C1E;
    --muted-color:              #8E8E93;
    --accent-color:             #2E7D32;
    --focus-ring:               rgba(46, 125, 50, 0.42);
    --tile-bg:                  #FFFFFF;
    --tile-hover-bg:            #F2F2F7;
    --tile-shadow:              0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02);
    --tile-radius:              12px;
    --tile-y-pad:               8px;
    --input-border:             #D1D5DB;
    --surface-border:           rgba(0, 0, 0, 0.06);
    --surface-strong:           rgba(255, 255, 255, 0.82);
    --hover-shadow:             0 4px 12px rgba(0,0,0,0.08);
    --section-color:            #3C3C43;
    color-scheme:               light;
}

/* Explicit dark theme toggled by user */
html.theme-dark {
    --bg-color:                 #1C1C1E;
    --text-color:               #F5F5F7;
    --muted-color:              #A1A1A6;
    --accent-color:             #3E9443;
    --focus-ring:               rgba(62, 148, 67, 0.48);
    --tile-bg:                  #2C2C2E;
    --tile-hover-bg:            #3A3A3C;
    --tile-shadow:              0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.12);
    --input-border:             #48484A;
    --surface-border:           rgba(255, 255, 255, 0.08);
    --surface-strong:           rgba(44, 44, 46, 0.72);
    --hover-shadow:             0 4px 12px rgba(0,0,0,0.32);
    --section-color:            #AEAEB2;
    color-scheme:               dark;
}

/* Explicit light theme class to override system dark */
html.theme-light {
    --bg-color:                 #E5E5EA;
    --text-color:               #1C1C1E;
    --muted-color:              #8E8E93;
    --accent-color:             #2E7D32;
    --focus-ring:               rgba(46, 125, 50, 0.42);
    --tile-bg:                  #FFFFFF;
    --tile-hover-bg:            #F2F2F7;
    --tile-shadow:              0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.02);
    --surface-border:           rgba(0, 0, 0, 0.06);
    --surface-strong:           rgba(255, 255, 255, 0.82);
    --hover-shadow:             0 4px 12px rgba(0,0,0,0.08);
    --section-color:            #3C3C43;
    color-scheme:               light;
}

html.theme-dark #controls {
    background:                  var(--surface-strong);
    border-color:                var(--surface-border);
    box-shadow:                  0 2px 8px rgba(0,0,0,0.24);
}

html {
    overflow-y:                 scroll;
}

body {
    background-color:           var(--bg-color);
    font-family:                -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, sans-serif;
    color:                      var(--text-color);
    margin:                     0px 0px 0px 0px;
    padding:                    0px 24px 28px 24px;
    -ms-overflow-style:         auto;
    scrollbar-width:            thin;
}

/* Clean flat background — no pattern */

/* Subtle WebKit scrollbar styling */
html::-webkit-scrollbar,
body::-webkit-scrollbar {
    width:                      6px;
    height:                     6px;
}

html::-webkit-scrollbar-thumb,
body::-webkit-scrollbar-thumb {
    background:                 rgba(0, 0, 0, 0.15);
    border-radius:              999px;
}

html.theme-dark::-webkit-scrollbar-thumb,
html.theme-dark body::-webkit-scrollbar-thumb {
    background:                 rgba(255, 255, 255, 0.12);
}

.win body {
    font-family:                Arial, sans-serif;
}

body.large  { font-size:         16px; }
body.medium { font-size:         14px; }
body.small  { font-size:         12px; }

a {
    color:                      var(--accent-color);
    text-decoration:            none;
    transition:                 opacity 100ms ease;
}

a:hover {
    opacity:                    0.82;
}

#getstarted-overlay {
    display:                    none;
    position:                   fixed;
    inset:                      0;
    z-index:                    100;
    align-items:                flex-start;
    justify-content:            center;
    padding-top:                min(12vh, 120px);
    animation:                  helpFadeIn 200ms ease;
}

#getstarted-overlay.visible {
    display:                    flex;
}

.getstarted-backdrop {
    position:                   fixed;
    inset:                      0;
    background:                 rgba(0, 0, 0, 0.25);
    -webkit-backdrop-filter:    blur(6px);
    backdrop-filter:            blur(6px);
}

html.theme-dark .getstarted-backdrop {
    background:                 rgba(0, 0, 0, 0.45);
}

#getstarted {
    position:                   relative;
    width:                      min(640px, calc(100vw - 48px));
    max-height:                 calc(100vh - min(12vh, 120px) - 40px);
    overflow-y:                 auto;
    font-size:                  1em;
    background:                 var(--tile-bg);
    border:                     1px solid var(--surface-border);
    border-radius:              14px;
    box-shadow:                 0 8px 30px rgba(0, 0, 0, 0.15),
                                0 0 0 1px var(--surface-border);
    padding:                    24px 28px 20px;
}

html.theme-dark #getstarted {
    box-shadow:                 0 8px 30px rgba(0, 0, 0, 0.4),
                                0 0 0 1px rgba(255, 255, 255, 0.08);
}

@keyframes helpFadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
}

#getstarted > h1 {
    color:                      var(--section-color);
    font-size:                  0.82em;
    font-weight:                600;
    letter-spacing:             0.03em;
    margin:                     0 0 10px 0;
}

#getstarted a {
    font-weight:                600;
    color:                      var(--accent-color);
}

#getstarted a:hover {
    text-decoration:            underline;
}

#getstarted > section {
    font-size:                  0.88em;
    font-weight:                normal;
    letter-spacing:             0.01em;
    line-height:                1.5;
}

#getstarted p {
    margin-top:                 0px;
}

#getstarted h2 {
    font-size:                  0.82em;
    font-weight:                600;
    color:                      var(--section-color);
    letter-spacing:             0.03em;
    margin:                     16px 0 6px;
}

#getstarted ol,
#getstarted ul {
    padding-left:               20px;
}

#getstarted li {
    margin-bottom:              4px;
}

#bookmarks {
    padding-top:                52px;
    display:                    grid;
    grid-template-columns:      repeat(auto-fit, minmax(320px, 1fr));
    gap:                        24px 32px;
    align-items:                start;
}

#bookmarks > div {
    width:                      auto;
    margin:                     0;
    padding:                    0;
    min-width:                  0;
}

#bookmarks > .left {            float: none; }
#bookmarks > .right {           float: none; }

#bookmarks section {
    clear:                      none;
    padding:                    4px 0 10px 0;
    height:                     auto;
    overflow:                   visible;
}

#bookmarks h1 {
    position:                   relative;
    font-size:                  0.82em;
    color:                      var(--section-color);
    font-weight:                600;
    display:                    flex;
    align-items:                center;
    gap:                        10px;
    padding-left:               6px;
    letter-spacing:             0.03em;
    margin:                     0.5em 0 0.35em 0;
}

#bookmarks h1::after {
    content:                    '';
    flex:                       1 1 auto;
    height:                     1px;
    border-radius:              1px;
    background:                 linear-gradient(to right, rgba(0, 0, 0, 0.12), transparent);
}

html.theme-dark #bookmarks h1::after {
    background:                 linear-gradient(to right, rgba(255, 255, 255, 0.14), transparent);
}

/* Inline rename via contenteditable — just add dashed border, zero layout shift */
.edit #bookmarks h1.section-renaming {
    border:                     none;
}

.edit #bookmarks h1.section-renaming .section-title-text {
    outline:                    1px dashed var(--focus-ring);
    outline-offset:             2px;
    cursor:                     text;
}

.edit #bookmarks h1.section-renaming .section-color-dot {
    pointer-events:             none;
}

.edit #bookmarks h1.section-renaming::after {
    display:                    none;
}

html.theme-dark .edit #bookmarks h1.section-renaming .section-title-text {
    outline-color:              var(--focus-ring);
}

#bookmarks a {
    position:                   relative;
    display:                    inline-flex;
    align-items:                flex-start;
    gap:                        4px;
    vertical-align:             bottom;
    text-decoration:            none;
    font-size:                  0.95em;
    font-weight:                normal;
    letter-spacing:             0.01em;
    line-height:                1.35;
    background-color:           var(--tile-bg);
    border-radius:              var(--tile-radius);
    box-shadow:                 var(--tile-shadow);
    border:                     1px solid var(--surface-border);
    box-sizing:                 border-box;
    width:                      10.5em;
    height:                     calc(3 * 1.35em + var(--tile-y-pad));
    padding:                    8px 10px 6px 8px;
    margin:                     3px 5px 5px 3px;
    overflow:                   hidden;
    text-overflow:              ellipsis;
    transition:                 transform 120ms ease, background-color 150ms ease, box-shadow 150ms ease, border-color 150ms ease;
    color:                      var(--text-color);
}

#bookmarks a:hover {
    background-color:           var(--tile-hover-bg);
    transform:                  translateY(-1px);
    box-shadow:                 var(--hover-shadow);
    border-color:               rgba(0, 0, 0, 0.1);
}

html.theme-dark #bookmarks a:hover {
    background-color:           var(--tile-hover-bg);
    border-color:               rgba(255, 255, 255, 0.12);
    box-shadow:                 var(--hover-shadow);
}

.edit #bookmarks a:hover {
    background-color:           #FFF3E0;
}

html.theme-dark .edit #bookmarks a:hover {
    background-color:           #FFF8E1;
    color:                      #1C1C1E;
}

#bookmarks a > img {
    margin-right:               0px;
    margin-bottom:              0px;
    width:                      1.15em;
    height:                     1.15em;
    flex:                       0 0 auto;
    align-self:                 flex-start;
    object-fit:                 contain;
}

/* Broken images keep their box so layout stays stable */
#bookmarks a > img[src=""],
#bookmarks a > img:not([src]) {
    visibility:                 hidden;
}

#bookmarks a > span {
    display:                    -webkit-box;
    -webkit-line-clamp:         3;
    -webkit-box-orient:         vertical;
    line-clamp:                 3;
    overflow:                   hidden;
    text-overflow:              ellipsis;
    white-space:                normal;
    word-break:                 break-word;
    flex:                       1 1 auto;
    min-width:                  0;
    height:                     calc(3 * 1.35em);
}

#bookmarks a.removed {
    opacity: 0;
    transform: scale(0.92);
    max-height: 0;
    margin-top: 0;
    margin-bottom: 0;
    padding-top: 0;
    padding-bottom: 0;
    overflow: hidden;
    transition: opacity 300ms ease, transform 300ms ease, max-height 300ms 100ms ease, margin 300ms 100ms ease, padding 300ms 100ms ease;
}

#bookmarks a.add {
    position:                   absolute;
    right:                      66px;
    top:                        6px;
    display:                    none;
    align-items:                center;
    justify-content:            center;
    width:                      26px;
    height:                     26px;
    border-radius:              8px;
    border:                     1px solid var(--surface-border);
    background:                 var(--tile-bg);
    color:                      var(--muted-color);
    box-shadow:                 none;
    margin:                     0;
    padding:                    0;
    line-height:                1;
    font-size:                  0.85rem;
    font-weight:                normal;
    cursor:                     pointer;
    box-sizing:                 border-box;
    opacity:                    0.6;
    z-index:                    5;
    overflow:                   visible;
    text-overflow:              clip;
    transition:                 opacity 120ms ease, background-color 120ms ease, border-color 120ms ease;
}

.edit #bookmarks a.add { display: inline-flex; }

#bookmarks section { position: relative; }

#bookmarks section > .section-remove {
    position:                   absolute;
    right:                      6px;
    top:                        6px;
    width:                      26px;
    height:                     26px;
    display:                    none;
    align-items:                center;
    justify-content:            center;
    border-radius:              8px;
    border:                     1px solid rgba(211, 47, 47, 0.25);
    background:                 var(--tile-bg);
    color:                      #DC2626;
    padding:                    0;
    font-size:                  1rem;
    line-height:                1;
    cursor:                     pointer;
    box-sizing:                 border-box;
    opacity:                    0.6;
    transition:                 opacity 120ms ease, background-color 120ms ease, border-color 120ms ease;
}

.edit #bookmarks section > .section-remove {
    display:                    inline-flex;
}

#bookmarks section > .section-remove:hover {
    background:                 #FEF2F2;
    border-color:               #EF4444;
    color:                      #DC2626;
    opacity:                    1;
}

html.theme-dark #bookmarks section > .section-remove {
    border-color:               rgba(248, 113, 113, 0.3);
    background:                 var(--tile-bg);
    color:                      #FCA5A5;
}

html.theme-dark #bookmarks section > .section-remove:hover {
    background:                 #3A2020;
    border-color:               #F87171;
    color:                      #FECACA;
    opacity:                    1;
}

#bookmarks a.add:hover {
    opacity:                    1;
    background:                 var(--tile-hover-bg);
    color:                      var(--text-color);
}

html.theme-dark #bookmarks a.add {
    border-color:               rgba(255, 255, 255, 0.1);
    background:                 var(--tile-bg);
    color:                      var(--muted-color);
}

html.theme-dark #bookmarks a.add:hover {
    background:                 var(--tile-hover-bg);
    color:                      var(--text-color);
}

#bookmarks a.add span {
    display:                    inline-block;
    flex:                       0 0 auto;
    font-size:                  1.1em;
    line-height:                1;
    height:                     auto;
}

#bookmarks a.add img { display: none; }

#bookmarks a.drop-placeholder {
    display: inline-block;
    width: 10.5em;
    height: calc(3 * 1.35em + var(--tile-y-pad));
    margin: 3px 5px 5px 3px;
    border-radius: var(--tile-radius);
    border: 2px dashed var(--accent-color);
    opacity: 0.65;
    background: transparent;
    box-shadow: none;
    animation: placeholderPulse 1.2s ease-in-out infinite;
}

@keyframes placeholderPulse {
    0%, 100% { opacity: 0.65; }
    50%      { opacity: 0.35; }
}

/* Collapsed placeholder used at the source position so items shift left */
#bookmarks a.drop-placeholder.collapsed {
    width: 0.01px;
    margin: 0;
    border: none;
}

#add-section-cta-wrap {
    display:                    none;
    justify-content:            center;
    align-items:                center;
    padding:                    16px 0 8px;
}

.edit #add-section-cta-wrap {
    display:                    flex;
}

#add-section-cta {
    display:                    inline-flex;
    align-items:                center;
    justify-content:            center;
    width:                      48px;
    height:                     48px;
    border-radius:              999px;
    background:                 var(--tile-bg);
    border:                     1.5px dashed var(--accent-color);
    color:                      var(--accent-color);
    font-size:                  1.8rem;
    line-height:                1;
    box-shadow:                 var(--tile-shadow);
    transition:                 transform 120ms ease, box-shadow 120ms ease, background-color 120ms ease;
    opacity:                    0.7;
}

#add-section-cta:hover {
    background:                 var(--tile-hover-bg);
    transform:                  translateY(-1px);
    box-shadow:                 var(--hover-shadow);
    opacity:                    1;
}

html.theme-dark #add-section-cta {
    border-color:               var(--accent-color);
}

.ui-add-section-form > select {
    width:                      100%;
    margin-top:                 10px;
}

/* While dragging, hide the original tile so it doesn't look duplicated */
.edit #bookmarks a.dragging {
    opacity: 0;
    box-shadow: none;
    cursor: grabbing;
    position: absolute; /* remove from document flow so neighbors shift left */
    pointer-events: none;
}

#controls {
    position:                   fixed;
    top:                        10px;
    right:                      24px;
    z-index:                    20;
    display:                    flex;
    align-items:                center;
    gap:                        6px;
    width:                      auto;
    max-width:                  calc(100vw - 24px);
    margin:                     0;
    padding:                    0;
}

#controls-toggle {
    display:                    inline-flex;
    align-items:                center;
    justify-content:            center;
    min-width:                  56px;
    height:                     34px;
    margin:                     0;
    padding:                    0 12px;
    border-radius:              999px;
    color:                      var(--text-color);
    font-size:                  12px;
    letter-spacing:             0.06em;
    text-transform:             lowercase;
    font-weight:                600;
    line-height:                1;
    background:                 var(--surface-strong);
    border:                     1px solid var(--surface-border);
    box-shadow:                 0 2px 8px rgba(0,0,0,0.06);
    -webkit-backdrop-filter:    saturate(120%) blur(12px);
    backdrop-filter:            saturate(120%) blur(12px);
}

#edit {
    display:                    inline-flex;
    align-items:                center;
    justify-content:            center;
    min-width:                  44px;
    height:                     34px;
    margin:                     0;
    padding:                    0 12px;
    border-radius:              999px;
    color:                      var(--text-color);
    font-size:                  12px;
    letter-spacing:             0.06em;
    text-transform:             lowercase;
    font-weight:                600;
    line-height:                1;
    background:                 var(--surface-strong);
    border:                     1px solid var(--surface-border);
    box-shadow:                 0 2px 8px rgba(0,0,0,0.06);
    -webkit-backdrop-filter:    saturate(120%) blur(12px);
    backdrop-filter:            saturate(120%) blur(12px);
    cursor:                     pointer;
    transition:                 background-color 120ms ease, color 120ms ease, border-color 120ms ease;
}

#edit:hover {
    background:                 var(--tile-hover-bg);
}

#edit:focus-visible {
    outline:                    2px solid var(--focus-ring);
    outline-offset:             2px;
}

.edit #edit {
    background:                 var(--accent-color);
    color:                      #fff;
    border-color:               var(--accent-color);
}

.edit #edit:hover {
    opacity:                    0.88;
}

html.theme-dark #edit {
    box-shadow:                 0 2px 8px rgba(0,0,0,0.24);
}

#controls-panel {
    position:                   absolute;
    top:                        40px;
    right:                      0;
    min-width:                  176px;
    padding:                    8px;
    border-radius:              14px;
    background:                 var(--surface-strong);
    border:                     1px solid var(--surface-border);
    box-shadow:                 0 8px 24px rgba(0,0,0,0.12);
    -webkit-backdrop-filter:    saturate(120%) blur(12px);
    backdrop-filter:            saturate(120%) blur(12px);
    display:                    flex;
    flex-direction:             column;
    gap:                        3px;
    opacity:                    0;
    visibility:                 hidden;
    transform:                  translateY(-6px) scale(0.97);
    transform-origin:           top right;
    transition:                 opacity 120ms ease, visibility 120ms ease, transform 120ms ease;
    pointer-events:             none;
}

#controls.expanded #controls-panel {
    opacity:                    1;
    visibility:                 visible;
    transform:                  translateY(0) scale(1);
    pointer-events:             auto;
}

#controls-panel .controls-title {
    font-size:                  11px;
    letter-spacing:             0.08em;
    text-transform:             uppercase;
    color:                      var(--muted-color);
    padding:                    2px 10px 6px 10px;
    user-select:                none;
}

#controls-panel > div,
#controls-panel > a {
    display:                    block;
}

#controls-panel a {
    display:                    flex;
    align-items:                center;
    justify-content:            space-between;
    min-height:                 34px;
    font-size:                  15px;
    font-weight:                500;
    margin:                     0;
    padding:                    7px 10px;
    border-radius:              10px;
    color:                      var(--text-color);
    cursor:                     pointer;
}

#controls-panel a {
    transition:                 background-color 100ms ease;
    opacity:                    1;
}

#controls-panel a:hover, #controls-panel a.selected {
    text-decoration:            none;
    background-color:           var(--tile-hover-bg);
    opacity:                    1;
}

#controls-toggle:focus-visible,
#controls-panel a:focus-visible {
    outline:                    2px solid var(--focus-ring);
    outline-offset:             2px;
}

/* Dropdown controls */
#controls .dropdown { display: block; position: relative; }
#controls .dropdown-toggle { padding: 7px 10px; border-radius: 10px; }
#controls .dropdown-menu {
    position: static;
    margin-top: 2px;
    background: var(--tile-bg);
    border: 1px solid var(--surface-border);
    border-radius: 10px;
    box-shadow: none;
    display: none;
    min-width: unset;
    padding: 4px;
}
#controls .dropdown-menu a {
    display: block;
    min-height:                 30px;
    font-size:                  13px;
    font-weight:                500;
    padding: 6px 8px;
    border-radius: 6px;
    justify-content: flex-start;
}
#controls .dropdown-menu a:hover { background: var(--tile-hover-bg); }
#controls .dropdown.open .dropdown-menu { display: block; }

:-webkit-any(.ui-edit-form,.ui-add-form) > input {
    clear: both;
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--input-border);
    box-shadow: none;
    margin-top: 10px;
    border-radius: 10px;
    box-sizing: border-box;
    transition: border-color 120ms ease;
}

:-webkit-any(.ui-edit-form,.ui-add-form) > input:focus {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
    border-color: var(--accent-color);
}

.ui-hidden-select {
    display: none !important;
}

.ui-custom-select {
    position: relative;
    clear: both;
    width: 100%;
    margin-top: 10px;
}

.ui-custom-select-trigger {
    width: 100%;
    min-height: 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid var(--input-border);
    background: var(--tile-bg);
    color: var(--text-color);
    box-shadow: none;
    box-sizing: border-box;
    cursor: pointer;
    font-size: 14px;
    text-align: left;
    transition: border-color 120ms ease;
}

.ui-custom-select-label {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding-right: 8px;
}

.ui-custom-select-caret {
    color: var(--muted-color);
    font-size: 12px;
    line-height: 1;
    transition: transform 120ms ease;
}

.ui-custom-select.open .ui-custom-select-caret {
    transform: rotate(180deg);
}

.ui-custom-select-trigger:focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
    border-color: var(--accent-color);
}

.ui-custom-select-menu {
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    right: 0;
    z-index: 30;
    max-height: 250px;
    overflow-y: auto;
    padding: 4px;
    border-radius: 10px;
    border: 1px solid var(--surface-border);
    background: var(--tile-bg);
    box-shadow: 0 10px 26px rgba(0,0,0,0.16);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-4px);
    transition: opacity 100ms ease, visibility 100ms ease, transform 100ms ease;
    pointer-events: none;
}

.ui-custom-select.open .ui-custom-select-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    pointer-events: auto;
}

.ui-custom-select-option {
    width: 100%;
    min-height: 33px;
    display: block;
    border: 0;
    margin: 0;
    padding: 7px 10px;
    border-radius: 8px;
    background: transparent;
    color: var(--text-color);
    text-align: left;
    font-size: 14px;
    line-height: 1.3;
    cursor: pointer;
    transition: background-color 80ms ease;
}

.ui-custom-select-option:hover,
.ui-custom-select-option.focused {
    background: var(--tile-hover-bg);
}

.ui-custom-select-option:focus-visible {
    background: var(--tile-hover-bg);
    outline: 2px solid var(--focus-ring);
    outline-offset: -2px;
}

.ui-custom-select-option.selected {
    background: var(--accent-color);
    color: #fff;
    font-weight: 600;
}

.ui-edit-form > a.remove {
    color: #DC2626;
    display: inline-block;
    margin-top: 25px;
    font: -webkit-small-control;
}

.ui-edit-form > a.remove:hover {
    text-decoration: underline;
}

/* Dialog input dark-mode refinement */
html.theme-dark #dialog input,
html.theme-dark #dialog select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid var(--input-border);
    background: var(--tile-bg);
    color: var(--text-color);
    box-sizing: border-box;
}

html.theme-dark #dialog .actions {
    background: var(--tile-hover-bg) !important;
}

html.theme-dark #dialog {
    box-shadow: 0 8px 30px rgba(0,0,0,0.4) !important;
}

#notifications {
    top: auto !important;
    bottom: 10px;
}

/* Ensure dialog form fields never overflow the modal in any theme */
#dialog .ui-add-form > input,
#dialog .ui-edit-form > input,
#dialog .ui-edit-form > select {
    width: 100% !important;
    box-sizing: border-box;
}

#dialog .ui-edit-form > .ui-custom-select {
    width: 100% !important;
    box-sizing: border-box;
}

/* Spotlight search */
#spotlight {
    position:                    fixed;
    inset:                       0;
    z-index:                     900;
    display:                     flex;
    align-items:                 flex-start;
    justify-content:             center;
    padding-top:                 min(18vh, 160px);
    transition:                  opacity 150ms ease;
}

#spotlight.spotlight-hidden {
    opacity:                     0;
    pointer-events:              none;
}

.spotlight-backdrop {
    position:                    fixed;
    inset:                       0;
    background:                  rgba(0, 0, 0, 0.35);
    -webkit-backdrop-filter:     blur(4px);
    backdrop-filter:             blur(4px);
}

html.theme-dark .spotlight-backdrop {
    background:                  rgba(0, 0, 0, 0.55);
}

.spotlight-panel {
    position:                    relative;
    width:                       520px;
    max-width:                   calc(100vw - 40px);
    background:                  var(--tile-bg);
    border-radius:               14px;
    box-shadow:                  0 8px 30px rgba(0, 0, 0, 0.12),
                                 0 0 0 1px var(--surface-border);
    overflow:                    hidden;
    display:                     flex;
    flex-direction:              column;
}

html.theme-dark .spotlight-panel {
    box-shadow:                  0 8px 30px rgba(0, 0, 0, 0.4),
                                 0 0 0 1px rgba(255, 255, 255, 0.08);
}

#spotlight-input {
    appearance:                  none;
    -webkit-appearance:          none;
    width:                       100%;
    padding:                     16px 20px;
    border:                      none;
    border-bottom:               1px solid rgba(0, 0, 0, 0.06);
    background:                  transparent;
    color:                       var(--text-color);
    font-size:                   1.1em;
    font-family:                 inherit;
    outline:                     none;
    box-sizing:                  border-box;
}

html.theme-dark #spotlight-input {
    border-bottom-color:         rgba(255, 255, 255, 0.06);
}

#spotlight-input:focus-visible {
    box-shadow:                  inset 0 -2px 0 var(--accent-color);
}

#spotlight-results {
    list-style:                  none;
    margin:                      0;
    padding:                     6px;
    max-height:                  380px;
    overflow-y:                  auto;
    overscroll-behavior:         contain;
}

#spotlight-results:empty {
    display:                     none;
}

#spotlight-results li {
    display:                     flex;
    align-items:                 center;
    gap:                         10px;
    padding:                     10px 14px;
    border-radius:               10px;
    cursor:                      pointer;
    transition:                  background 80ms ease;
    color:                       var(--text-color);
}

#spotlight-results li:hover,
#spotlight-results li.selected {
    background:                  var(--tile-hover-bg);
}

html.theme-dark #spotlight-results li.selected {
    background:                  var(--tile-hover-bg);
}

#spotlight-results li .spotlight-icon {
    width:                       22px;
    height:                      22px;
    flex:                        0 0 22px;
    border-radius:               4px;
}

#spotlight-results li .spotlight-item-body {
    flex:                        1 1 auto;
    min-width:                   0;
    display:                     flex;
    flex-direction:              column;
    gap:                         2px;
}

#spotlight-results li .spotlight-title {
    font-size:                   0.95em;
    white-space:                 nowrap;
    overflow:                    hidden;
    text-overflow:               ellipsis;
}

#spotlight-results li .spotlight-title mark {
    background:                  rgba(46, 125, 50, 0.16);
    color:                       inherit;
    border-radius:               2px;
    padding:                     0 2px;
}

html.theme-dark #spotlight-results li .spotlight-title mark {
    background:                  rgba(62, 148, 67, 0.24);
}

#spotlight-results li .spotlight-url {
    font-size:                   0.78em;
    color:                       var(--muted-color);
    white-space:                 nowrap;
    overflow:                    hidden;
    text-overflow:               ellipsis;
}

#spotlight-results li .spotlight-section {
    flex:                        0 0 auto;
    font-size:                   0.72em;
    text-transform:              uppercase;
    letter-spacing:              0.04em;
    color:                       var(--muted-color);
    background:                  rgba(0, 0, 0, 0.04);
    padding:                     3px 8px;
    border-radius:               6px;
    white-space:                 nowrap;
}

html.theme-dark #spotlight-results li .spotlight-section {
    background:                  rgba(255, 255, 255, 0.06);
}

#spotlight-results li.spotlight-empty {
    justify-content:             center;
    color:                       var(--muted-color);
    font-size:                   0.88em;
    cursor:                      default;
    padding:                     14px;
}

#spotlight-results li.spotlight-empty:hover {
    background:                  transparent;
}

/* Scrollbar inside results */
#spotlight-results::-webkit-scrollbar { width: 5px; }
#spotlight-results::-webkit-scrollbar-thumb {
    background:                  rgba(0, 0, 0, 0.1);
    border-radius:               3px;
}
html.theme-dark #spotlight-results::-webkit-scrollbar-thumb {
    background:                  rgba(255, 255, 255, 0.1);
}

/* Tooltip with full title on hover - width fits the tile */
#bookmarks a:not(.add)[title]::after {
    content:                    attr(title);
    position:                   absolute;
    left:                       0;
    bottom:                     calc(100% + 8px);
    width:                      calc(100% - 4px);
    max-width:                  none;
    padding:                    6px 8px;
    background:                 var(--tile-bg);
    color:                      var(--text-color);
    border:                     1px solid var(--surface-border);
    border-radius:              8px;
    box-shadow:                 var(--hover-shadow);
    font-size:                  0.88em;
    opacity:                    0;
    transform:                  translateY(4px);
    transition:                 opacity 120ms ease, transform 120ms ease;
    pointer-events:             none;
    z-index:                    50;
    white-space:                normal;
}

#bookmarks a:not(.add)[title]:hover::after {
    opacity:                    1;
    transform:                  translateY(0);
}

/* Global focus visibility */
a:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible,
[contenteditable="true"]:focus-visible {
    outline:                    2px solid var(--focus-ring);
    outline-offset:             2px;
}

#bookmarks a:focus-visible {
    transform:                  translateY(-1px);
    box-shadow:                 0 0 0 2px var(--focus-ring), var(--tile-shadow);
}

/* Modernized dialog / notification look */
#dialog,
.notification {
    border-radius:              16px !important;
    border:                     1px solid var(--surface-border) !important;
    box-shadow:                 0 8px 30px rgba(0, 0, 0, 0.12) !important;
}

#dialog.dialog-form-wide {
    width:                      min(560px, calc(100vw - 32px));
    min-width:                  0;
    max-width:                  calc(100vw - 32px);
}

#dialog .content,
.notification .content {
    padding:                    20px 22px;
}

#dialog .actions,
.confirmation .actions {
    border-top:                 1px solid var(--surface-border) !important;
    background:                 rgba(0, 0, 0, 0.015);
}

html.theme-dark #dialog .actions,
html.theme-dark .confirmation .actions {
    background:                 rgba(255, 255, 255, 0.03);
}

#dialog .actions button {
    border-radius:              8px;
    padding:                    7px 14px;
    font-weight:                500;
}

#dialog .actions button.main {
    background:                 var(--accent-color);
    color:                      #FFFFFF;
    border:                     1px solid transparent;
}

#dialog .actions button.main:hover {
    text-decoration:            none;
    background:                 var(--accent-color);
    filter:                     brightness(1.12);
}

#dialog .actions button.main:active {
    background:                 var(--accent-color);
    filter:                     brightness(0.92);
}

/* Responsive layout */
@media (max-width: 760px) {
    body {
        padding:                0px 14px 20px 14px;
    }

    #controls {
        right:                  14px;
        max-width:              calc(100vw - 28px);
    }

    #controls-panel {
        min-width:              min(176px, calc(100vw - 28px));
        max-width:              calc(100vw - 28px);
    }

    #controls-toggle {
        min-width:              52px;
    }

    #bookmarks a {
        width:                  calc(50% - 8px);
    }
}

@media (max-width: 560px) {
    #bookmarks a {
        width:                  100%;
    }
}

/* Removed OS-level dark fallback to prevent light flash on load; explicit theme classes control palette */

/* Section drag & drop */
.edit #bookmarks section > h1.section-drag-handle {
    cursor:                     grab;
    user-select:                none;
    -webkit-user-select:        none;
}

.edit #bookmarks section > h1.section-drag-handle.section-renaming {
    cursor:                     text;
    user-select:                text;
    -webkit-user-select:        text;
}

.edit #bookmarks section > h1.section-drag-handle:active:not(.section-renaming) {
    cursor:                     grabbing;
}

.edit #bookmarks section.section-dragging {
    opacity:                    0.25;
    transition:                 opacity 150ms ease;
}

.section-drop-placeholder {
    height:                     4px;
    margin:                     6px 0;
    background:                 var(--accent-color);
    border-radius:              2px;
    opacity:                    0.7;
    animation:                  placeholderPulse 1.2s ease-in-out infinite;
}

.edit #bookmarks > .left.column-drop-target,
.edit #bookmarks > .right.column-drop-target {
    background:                 rgba(46, 125, 50, 0.08);
    border-radius:              var(--tile-radius);
    transition:                 background 150ms ease;
}

html.theme-dark .edit #bookmarks > .left.column-drop-target,
html.theme-dark .edit #bookmarks > .right.column-drop-target {
    background:                 rgba(62, 148, 67, 0.12);
}

/* --- Section color dot --- */

.section-color-dot {
    position:                   absolute;
    left:                       -6px;
    top:                        50%;
    transform:                  translateY(-50%);
    width:                      10px;
    height:                     10px;
    border-radius:              50%;
    display:                    none;
    border:                     1.5px solid rgba(0, 0, 0, 0.1);
    box-sizing:                 border-box;
    transition:                 transform 80ms ease, opacity 80ms ease;
    z-index:                    1;
}

html.theme-dark .section-color-dot {
    border-color:               rgba(255, 255, 255, 0.15);
}

section[data-section-color] .section-color-dot {
    display:                    block;
}

.edit section[data-section-color] .section-color-dot {
    cursor:                     pointer;
}

.edit #bookmarks h1:hover .section-color-dot {
    display:                    block;
    cursor:                     pointer;
}

.section-color-dot-empty {
    background:                 transparent;
    border-style:               dashed;
    opacity:                    0.4;
}

.edit .section-color-dot-empty:hover {
    opacity:                    1;
    border-color:               var(--accent-color);
}

.edit .section-color-dot:hover {
    transform:                  translateY(-50%) scale(1.3);
}

.section-title-text {
    flex-shrink:                0;
}

/* --- Color palette popup --- */

.section-color-palette {
    position:                   absolute;
    top:                        calc(100% + 4px);
    left:                       0;
    z-index:                    200;
    display:                    flex;
    flex-wrap:                  wrap;
    gap:                        5px;
    padding:                    10px;
    background:                 var(--surface-strong);
    border:                     1px solid var(--surface-border);
    border-radius:              12px;
    box-shadow:                 0 6px 20px rgba(0,0,0,0.14);
    -webkit-backdrop-filter:    saturate(120%) blur(12px);
    backdrop-filter:            saturate(120%) blur(12px);
    max-width:                  148px;
}

.color-swatch {
    width:                      24px;
    height:                     24px;
    border-radius:              50%;
    border:                     2px solid transparent;
    cursor:                     pointer;
    padding:                    0;
    outline:                    none;
    transition:                 transform 80ms ease, border-color 80ms ease, box-shadow 80ms ease;
}

.color-swatch:hover {
    transform:                  scale(1.2);
    box-shadow:                 0 2px 6px rgba(0,0,0,0.18);
}

.color-swatch.active {
    border-color:               var(--text-color);
    box-shadow:                 0 0 0 2px var(--bg-color), 0 0 0 3.5px var(--text-color);
}

.color-swatch-none {
    background:                 var(--tile-bg);
    border:                     2px dashed var(--muted-color);
    font-size:                  0.8em;
    color:                      var(--muted-color);
    display:                    flex;
    align-items:                center;
    justify-content:            center;
    line-height:                1;
}

.color-swatch-none:hover {
    border-color:               var(--text-color);
    color:                      var(--text-color);
}

/* Small swatches for add-section form */
.ui-color-label {
    font-size:                  0.82em;
    color:                      var(--muted-color);
    margin:                     8px 0 4px;
}

.ui-color-swatches {
    display:                    flex;
    flex-wrap:                  wrap;
    gap:                        5px;
}

.color-swatch-sm {
    width:                      20px;
    height:                     20px;
    border-radius:              50%;
    border:                     2px solid transparent;
    cursor:                     pointer;
    padding:                    0;
    outline:                    none;
    transition:                 transform 80ms ease, border-color 80ms ease;
}

.color-swatch-sm:hover {
    transform:                  scale(1.2);
}

.color-swatch-sm.active {
    border-color:               var(--text-color);
    box-shadow:                 0 0 0 1.5px var(--bg-color), 0 0 0 3px var(--text-color);
}

/* --- Sort button --- */

.section-sort {
    position:                   absolute;
    right:                      36px;
    top:                        6px;
    width:                      26px;
    height:                     26px;
    display:                    none;
    align-items:                center;
    justify-content:            center;
    border-radius:              8px;
    border:                     1px solid var(--surface-border);
    background:                 var(--tile-bg);
    color:                      var(--muted-color);
    padding:                    0;
    font-size:                  0.85rem;
    line-height:                1;
    cursor:                     pointer;
    box-sizing:                 border-box;
    opacity:                    0.6;
    transition:                 opacity 120ms ease, background-color 120ms ease, color 120ms ease;
}

.edit .section-sort {
    display:                    inline-flex;
}

.section-sort:hover {
    opacity:                    1;
    background:                 var(--tile-hover-bg);
    color:                      var(--text-color);
}

html.theme-dark .section-sort {
    border-color:               rgba(255, 255, 255, 0.1);
    background:                 var(--tile-bg);
    color:                      var(--muted-color);
}

html.theme-dark .section-sort:hover {
    background:                 var(--tile-hover-bg);
    color:                      var(--text-color);
}

.section-sort-menu {
    position:                   absolute;
    right:                      36px;
    top:                        32px;
    z-index:                    200;
    display:                    flex;
    flex-direction:             column;
    gap:                        2px;
    padding:                    5px;
    background:                 var(--surface-strong);
    border:                     1px solid var(--surface-border);
    border-radius:              10px;
    box-shadow:                 0 6px 20px rgba(0,0,0,0.14);
    -webkit-backdrop-filter:    saturate(120%) blur(12px);
    backdrop-filter:            saturate(120%) blur(12px);
    min-width:                  80px;
}

.sort-menu-option {
    display:                    flex;
    align-items:                center;
    justify-content:            center;
    padding:                    6px 12px;
    border:                     none;
    border-radius:              8px;
    background:                 transparent;
    color:                      var(--text-color);
    font-size:                  13px;
    font-weight:                500;
    cursor:                     pointer;
    white-space:                nowrap;
    transition:                 background-color 80ms ease;
}

.sort-menu-option:hover {
    background:                 var(--tile-hover-bg);
}

/* --- Click count badge --- */

.click-count {
    position:                   absolute;
    bottom:                     3px;
    right:                      6px;
    font-size:                  0.58em;
    color:                      var(--muted-color);
    opacity:                    0.45;
    pointer-events:             none;
    font-variant-numeric:       tabular-nums;
    letter-spacing:             0;
    line-height:                1;
}
